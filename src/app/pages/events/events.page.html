<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Eventos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-searchbar
    placeholder="Buscar..."
    showCancelButton="focus"
    [(ngModel)]="busqueda"
    (ionInput)="filtrarEventos()"
    animated="true">
  </ion-searchbar>

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-card *ngFor="let event of eventosVisibles">
    <img
      style="width:100%;height:160px;object-fit: cover;"
      *ngIf="event['images']?.sliderImage"
      [src]="event['images']?.sliderImage"
      [alt]="'portada de ' + (event['name'] || 'evento')" />

    <ion-card-header>
      <ion-card-title>{{ event['name'] }}</ion-card-title>

      <ion-card-subtitle *ngIf="event['eventDate']">
        Fecha: {{ event['eventDate'] | date:'fullDate' }}
      </ion-card-subtitle>

      <ion-card-subtitle *ngIf="event['venue']?.address?.city || event['venue']?.name">
        Lugar:
        {{ event['venue']?.name || '' }}
        <span *ngIf="event['venue']?.address?.city">
          - {{ event['venue']?.address?.city }}
        </span>
      </ion-card-subtitle>
    </ion-card-header>

    <ion-row>
      <ion-col>
        <ion-button expand="block" (click)="verMetricas(event.id)">Ver Evento</ion-button>
      </ion-col>

      <ion-col *ngIf="!isCliente()">
        <ion-button expand="block" (click)="escanear(event)">Escanear</ion-button>
      </ion-col>
    </ion-row>
  </ion-card>

  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Cargando mÃ¡s eventos...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
